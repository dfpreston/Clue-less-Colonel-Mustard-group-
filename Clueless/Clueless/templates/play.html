{% load static from staticfiles %}
{% block content %}
{% load static %}
    <!--<meta http-equiv="refresh" content="1">-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script  type="text/javascript">        
        console.log("Current data, per user:");
        console.log("Game Id:", {{ game_id }});
        console.log("Is Player Game Creator:", {{ is_creator | safe }});
        console.log("Is it Player\'s turn:", {{ player_turn | safe }});
        console.log("Player Name:", {{ player_name | safe }});
        console.log("Current Player Turn:", {{ curr_player_turn | safe }});
        console.log("Did Player Move:", {{ player_moved | safe }});
        console.log("Did Player Move Due to Suggestion:", {{ player_moved_suggest | safe }});
        console.log("Player Location:", {{ player_location | safe }});
        console.log("Did Player Make a Suggestion:", {{ player_suggested | safe }});
        console.log("Others Locations:", {{ others_locations | safe }})
        console.log("Player Hand:", {{ player_hand | safe}});
        console.log("All Available Cards:", {{ available_cards | safe}});
        console.log("Solution Cards:", {{ solution_cards | safe}});
        console.log("Suggested Cards:", {{ suggested_cards | safe}});
        console.log("Refuted Card:", {{ refuted_card | safe}});
        console.log("Player Status: ", {{ player_status | safe }});
        console.log("Game Status: ", {{ game_status | safe }});
        console.log("Game Winner: ", {{ game_winner | safe }});
        console.log("Player That Just Lost: ", {{ game_loser | safe }});
        console.log("Weapon Locations: ", {{ weapon_locations | safe }});
        console.log("Suspect Location: ", {{ suspect_locations | safe }});

        var solution_cards = {{ solution_cards | safe}};

        //NOTE: starting space to hallway is one-way connection
        //      => define connection in starting space but not adjacent hallway
        const idToText = {
            suspect1: {
                name: "Colonel Mustard",
                image: "{% static 'images/avatar_col_mustard.png' %}",
                cardPic: "{% static 'images/suspect1card.jpg' %}"
            },
            suspect2: {
                name: "Miss Scarlet",
                image: "{% static 'images/avatar_ms_scarlett.png' %}",
                cardPic: "{% static 'images/suspect2card.jpg' %}"
            },
            suspect3: {
                name: "Mr. Green",
                image: "{% static 'images/avatar_mr_green.png' %}",
                cardPic: "{% static 'images/suspect3card.jpg' %}"
            },
            suspect4: {
                name: "Mrs. Peacock",
                image: "{% static 'images/avatar_mrs_peacock.png' %}",
                cardPic: "{% static 'images/suspect4card.jpg' %}"
            },
            suspect5: {
                name: "Mrs. White",
                image: "{% static 'images/avatar_mrs_white.png' %}",
                cardPic: "{% static 'images/suspect5card.jpg' %}"
            },
            suspect6: {
                name: "Professor Plum",
                image: "{% static 'images/avatar_prof_plum.png' %}",
                cardPic: "{% static 'images/suspect6card.jpg' %}"
            },
            //weapons
            weapon1: {
                name: "Candlestick",
                image: "{% static 'images/weapon_candlestick.png' %}",
                cardPic: "{% static 'images/weapon1card.jpg' %}"
            },
            weapon2: {
                name: "Knife",
                image: "{% static 'images/weapon_knife.png' %}",
                cardPic: "{% static 'images/weapon2card.jpg' %}"
            },
            weapon3: {
                name: "Lead Pipe",
                image: "{% static 'images/weapon_lead_pipe.png' %}",
                cardPic: "{% static 'images/weapon3card.jpg' %}"
            },
            weapon4: {
                name: "Revolver",
                image: "{% static 'images/weapon_revolver.png' %}",
                cardPic: "{% static 'images/weapon4card.jpg' %}"
            },
            weapon5: {
                name: "Rope",
                image: "{% static 'images/weapon_rope.png' %}",
                cardPic: "{% static 'images/weapon5card.jpg' %}"
            },
            weapon6: {
                name: "Wrench",
                image: "{% static 'images/weapon_wrench.png' %}",
                cardPic: "{% static 'images/weapon6card.jpg' %}"
            },

            //rooms
            room1: {
                name: "Ballroom",
                connections: [
                    "hallway9", 
                    "hallway11",
                    "hallway12"
                ],
                image: "{% static 'images/room1.jpg' %}",
                cardPic: "{% static 'images/room1card.jpg' %}"
            },
            room2: {
                name: "Billiard Room",
                connections: [
                    "hallway4",
                    "hallway6",
                    "hallway7",
                    "hallway9"
                ],
                image: "{% static 'images/room2.jpg' %}",
                cardPic: "{% static 'images/room2card.jpg' %}"
            },
            room3: {
                name: "Conservatory",
                connections: [
                    "hallway8",
                    "hallway11",
                    "room8"
                ],
                image: "{% static 'images/room3.jpg' %}",
                cardPic: "{% static 'images/room3card.jpg' %}"
            },
            room4: {
                name: "Dining Room",
                connections: [
                    "hallway5",
                    "hallway7",
                    "hallway10"
                ],
                image: "{% static 'images/room4.jpg' %}",
                cardPic: "{% static 'images/room4card.jpg' %}"
            },
            room5: {
                name: "Hall",
                connections: [
                    "hallway1",
                    "hallway2",
                    "hallway4"
                ],
                image: "{% static 'images/room5.jpg' %}",
                cardPic: "{% static 'images/room5card.jpg' %}"
            },
            room6: {
                name: "Kitchen",
                connections: [
                    "hallway10",
                    "hallway12",
                    "room9"
                ],
                image: "{% static 'images/room6.jpg' %}",
                cardPic: "{% static 'images/room6card.jpg' %}"
            },
            room7: {
                name: "Library",
                connections: [
                    "hallway3",
                    "hallway6",
                    "hallway8"
                ],
                image: "{% static 'images/room7.jpg' %}",
                cardPic: "{% static 'images/room7card.jpg' %}"
            },
            room8: {
                name: "Lounge",
                connections: [
                    "hallway2",
                    "hallway5",
                    "room3"
                ],
                image: "{% static 'images/room8.jpg' %}",
                cardPic: "{% static 'images/room8card.jpg' %}"
            },
            room9: {
                name: "Study",
                connections: [
                    "hallway1",
                    "hallway3",
                    "room6"
                ],
                image: "{% static 'images/room9.jpg' %}",
                cardPic: "{% static 'images/room9card.jpg' %}"
            },

            //hallways
            hallway1: {
                name: getHallwayName("Hall", "Study"),
                connections: [
                    "room5",
                    "room9"
                ],
                image: "{% static 'images/hallway-h.jpg' %}"
            },
            hallway2: {
                name: getHallwayName("Hall", "Lounge"),
                connections: [
                    "room5",
                    "room8"
                ],
                image: "{% static 'images/hallway-h.jpg' %}"
            },
            hallway3: {
                name: getHallwayName("Study", "Library"),
                connections: [
                    "room7",
                    "room9"
                ],
                image: "{% static 'images/hallway-v.jpg' %}"
            },
            hallway4: {
                name: getHallwayName("Hall", "Billiard Room"),
                connections: [
                    "room5",
                    "room2"
                ],
                image: "{% static 'images/hallway-v.jpg' %}"
            },
            hallway5: {
                name: getHallwayName("Lounge", "Dining Room"),
                connections: [
                    "room8",
                    "room4"
                ],
                image: "{% static 'images/hallway-v.jpg' %}"
            },
            hallway6: {
                name: getHallwayName("Billiard Room", "Library"),
                connections: [
                    "room2",
                    "room7"
                ],
                image: "{% static 'images/hallway-h.jpg' %}"
            },
            hallway7: {
                name: getHallwayName("Billiard Room", "Dining Room"),
                connections: [
                    "room2",
                    "room4"
                ],
                image: "{% static 'images/hallway-h.jpg' %}"
            },
            hallway8: {
                name: getHallwayName("Library", "Conservatory"),
                connections: [
                    "room7",
                    "room3"
                ],
                image: "{% static 'images/hallway-v.jpg' %}"
            },
            hallway9: {
                name: getHallwayName("Billiard Room", "Ballroom"),
                connections: [
                    "room2",
                    "room1"
                ],
                image: "{% static 'images/hallway-v.jpg' %}"
            },
            hallway10: {
                name: getHallwayName("Dining Room", "Kitchen"),
                connections: [
                    "room4",
                    "room6"
                ],
                image: "{% static 'images/hallway-v.jpg' %}"
            },
            hallway11: {
                name: getHallwayName("Conservatory", "Ballroom"),
                connections: [
                    "room3",
                    "room1"
                ],
                image: "{% static 'images/hallway-h.jpg' %}"
            },
            hallway12: {
                name: getHallwayName("Ballroom", "Kitchen"),
                connections: [
                    "room1",
                    "room6"
                ],
                image: "{% static 'images/hallway-h.jpg' %}"
            },

            //starting spaces
            scarlet_start:
            {
                name: "Scarlet starting space",
                connections: [ "hallway2" ]
            },
            mustard_start:
            {
                name: "Mustard starting space",
                connections: [ "hallway5" ]
            },
            white_start:
            {
                name: "White starting space",
                connections: [ "hallway12" ]
            },
            green_start:
            {
                name: "Green starting space",
                connections: [ "hallway11" ]
            },
            peacock_start:
            {
                name: "Peacock starting space",
                connections: [ "hallway8" ]
            },
            plum_start:
            {
                name: "Plum starting space",
                connections: [ "hallway3" ]
            }
        }

        const textToId = {
            "Candlestick": "weapon1",
            "Knife": "weapon2",
            "Lead Pipe": "weapon3",
            "Revolver": "weapon4",
            "Rope": "weapon5",
            "Wrench": "weapon6",
            "Ballroom": "room1",
            "Billiard Room": "room2",
            "Conservatory": "room3",
            "Dining Room": "room4",
            "Hall": "room5",
            "Kitchen": "room6",
            "Library": "room7",
            "Lounge": "room8",
            "Study": "room9",
            "Scarlet starting space": "scarlet_start",
            "Mustard starting space": "mustard_start",
            "White starting space": "white_start",
            "Green starting space": "green_start",
            "Peacock starting space": "peacock_start",
            "Plum starting space": "plum_start",
            "Colonel Mustard": "suspect1",
            "Miss Scarlet": "suspect2",
            "Mr. Green": "suspect3",
            "Mrs. Peacock": "suspect4",
            "Mrs. White": "suspect5",
            "Professor Plum": "suspect6"
        }

        function getHallwayName(room1, room2) {
            return "hallway between the " + room1 + " and the " + room2;
        }

        function addItemToList(item, listToAddTo) {
            var list = document.getElementById(listToAddTo);
            var option = document.createElement("option");
            option.text = idToText[item].name;
            option.value = item;
            list.add(option);
        }

        function addCardToNotebook(cardType, card) {
            $("#notebook").find("tbody").append(
                "<tr id='" + card + "'>" + 
                    "<td>" + cardType + "</td>" + 
                    "<td>" + idToText[card].name + "</td>" + 
                    '<td title="Evidence not yet found"><input type="checkbox" disabled/></td>' +
                "</tr>"
            );
        }

        function addImageToBoard(card, isRoom) {
            let locId;
            if (isRoom) {
                locId = "#r" + card.substring(4); 
            } else {
                locId = "#h" + card.substring(7);
            }
            $(locId).append(
                "<img src="+idToText[card].image + " />"
            );
        }

        $(document).ready(function() {

        	//hide solution
        	$("#solutionContainer").hide();

            // prepare the detective notebook and game board
            Object.keys(idToText).forEach(card => {
                if (card.includes("suspect")) {
                   addCardToNotebook("Suspect", card);
                } else if (card.includes("weapon")) {
                    addCardToNotebook("Weapon", card);
                } else if (card.includes("room")) {
                    addCardToNotebook("Room", card);
                    addImageToBoard(card, true);
                } else {
                    addImageToBoard(card, false);
                }
            });

            // construct player's hand
            playerHand = {{ player_hand | safe}};

            Object.keys(playerHand).forEach(cardType => {
                playerHand[cardType].forEach(card => {
                    $("#player-hand").append(
                        "<div class='cardWrapper'><img class='card' src=" + idToText[card].cardPic + "></div>"
                    );
                    $("#" + card).find("input").prop("checked", true);
                    $("#" + card).find("input").attr("title", "Source: my hand");
                });
            });

            // Notify player if they are the winner
            if( {{ game_status | safe }} == "COMPLETED"){
                if ({{ game_winner | safe }} == ''){
                	showSolutionSet("No one");
                    //alert('No one has won this game...\nSolution set is: ' + idToText[solution_cards["Suspects"][0]]["name"] + ' in the ' + idToText[solution_cards["Rooms"][0]]["name"] + ' with the ' + idToText[solution_cards["Weapons"][0]]["name"]);
                }
                else {
                	showSolutionSet({{player_name | safe}});
                    //alert( {{ game_winner | safe }} +' has won the game!!\nSolution set is: ' + idToText[solution_cards["Suspects"][0]]["name"] + ' in the ' + idToText[solution_cards["Rooms"][0]]["name"] + ' with the ' + idToText[solution_cards["Weapons"][0]]["name"]);
                }
                //location.replace("/");
            };

            // Player's turn options
            if (!"{{ player_turn }}") {
                $(".is-players-turn").hide();
            } else {
                $(".is-players-turn").hide();
                $("#turn-options-menu").show();
            }

            // Notify player of current location
            $("#player-location-msg").text("You are in the " + idToText[{{ player_location | safe }}].name);

            // Images of suspect icons
            var suspectLocations = {{ suspect_locations | safe }};
            Object.keys(suspectLocations).forEach(suspect => {
                let currSuspectLocation = suspectLocations[suspect];
                let locationId = currSuspectLocation.includes("room") ?
                    "#r" + currSuspectLocation.substring(4) + "c" :
                    "#h" + currSuspectLocation.substring(7);
                $(locationId).prepend('<div class="column"><img src="'+idToText[suspect].image + '" class="player token"></div>');
            });

            // Images of weapon icons
            var weaponLocations = {{ weapon_locations | safe }};
            Object.keys(weaponLocations).forEach(weapon => {
                let currWeaponLocation = weaponLocations[weapon];
                let locationId = "#r" + currWeaponLocation.substring(4) + "w";
                $(locationId).prepend('<div class="column"><img src="'+idToText[weapon].image + '" class="weapon token"></div>');
            });


            var player_cards = {{player_hand | safe}};

            // initialize suspect, weapon, and location options
            Object.keys(idToText).forEach(id => {
                if (id.includes("room")) {
                    if ("Rooms" in player_cards && !player_cards['Rooms'].includes(id)) {
                        addItemToList(id, "accuse-location");
                    }
                } else if (id.includes("suspect")) {
                    if("Suspects" in player_cards && !player_cards['Suspects'].includes(id)){
                        addItemToList(id, "accuse-suspect");
                    }
                    addItemToList(id, "suggest-suspect");
                } else if (id.includes("weapon")) {
                    if("Weapons" in player_cards && !player_cards['Weapons'].includes(id)){
                        addItemToList(id, "accuse-weapon");
                    }
                    addItemToList(id, "suggest-weapon");
                }
            });
            // Listen for game updates if not player's turn
            if(!{{player_turn}}) {
                if(!$.isEmptyObject( {{ suggested_cards | safe}} )){
                    var suggestion = {{suggested_cards | safe}};
                    var suggestor = {{curr_player_turn|safe}};
                    var sus = idToText[suggestion['Suspects'][0]]['name'];
                    var weapon = idToText[suggestion['Weapons'][0]]['name'];
                    var room = idToText[suggestion['Rooms'][0]]['name'];

                    var msg = "<h3>" + suggestor + " has suggested it was " + sus + "  with the " + weapon + " in the " + room + "</h3>";
                    $("#game-info").html(msg);
                    setInterval(function(){
                        $.ajax({
                            type: "GET",
                            url: "/play/",
                            success: function() {
                                location.reload();
                            }
                        });
                    }, 10000);
                }
                else if({{refuted_card | safe}} != ''){
                    var card = idToText[{{refuted_card | safe}}]['name'];
                    var msg = "<h3>Suggestion refuted with card: " + card + "</h3>";
                    $("#game-info").html(msg);

                    setInterval(function(){
                        $.ajax({
                            type: "GET",
                            url: "/play/",
                            success: function() {
                                location.reload();
                            }
                        });
                    }, 5000);
                }
                else{
                    setInterval(function(){
                        $.ajax({
                            type: "GET",
                            url: "/play/",
                            success: function() {
                                location.reload();
                            }
                        });
                    }, 5000);
                }
            }
            else{
                if({{refuted_card|safe}} != ''){
                    var msg = "<h3>Your suggestion was refuted with card: " + idToText[{{refuted_card|safe}}]['name'] + "</h3>";
                    $("#game-info").html(msg);
                    const card = {{refuted_card|safe}};
                    // Update detective notebook
                    $("#" + card).find("input").prop("checked", true);
                    $("#" + card).find("input").attr("title", "Source: refuted suggestion");
                }
            }
            if({{player_turn}} && 'Weapons' in {{suggested_cards|safe}}) {
                setInterval(function() {
                    $.ajax({
                        type: "GET",
                        url: "/play/",
                        success: function() {
                            location.reload();
                        }
                    });
                }, 5000);
            }
        });

        function showTurnOptions() {
            $(".is-players-turn").hide();
            $("#turn-options-menu").show();
        }

        function move() {
            $("#move-options").empty();

            let moveOptions = idToText[{{ player_location | safe }}].connections;
            moveOptions.forEach(moveOpt => {
                // only check occupied hallways, not rooms
                let occupied = 0;
                if (moveOpt.includes("hall")) {
                    var otherLocs = {{others_locations|safe}}
                    for(x in otherLocs){
                        if(otherLocs[x] == moveOpt) occupied=1;
                    }
                }

                if (occupied == 0) {
                    var move_list = document.getElementById("move-options");
                    var option = document.createElement("option");
                    option.text = idToText[moveOpt].name;
                    move_list.add(option);
                }
            });
            $("#turn-options-menu").hide();
            $("#move-options-menu").show();
        }

        function movePlayer(){
            var move = document.getElementById("move-options");
            l = idToText[{{ player_location | safe }}].connections[move.selectedIndex];

            url = "/play/?player_location="+l;

            $.ajax({
                type: "POST",
                url: url,
                success: function() {
                    location.reload();
                }
            });
        }

        function suggest() {
            $("#turn-options-menu").hide();
            $("#make-suggestion-menu").show();
        }

        function accuse() {
            $("#turn-options-menu").hide();
            $("#make-accusation-menu").show();
        }

        function refute() {
            $("#refute-options").empty();

            const playerHand = {{ player_hand | safe}};
            const suggestedCards = {{ suggested_cards | safe}};

            Object.keys(playerHand).forEach(cardType => {
                playerHand[cardType].forEach(card => {
                    //alert(card);
                    //alert(suggestedCards[cardType]);

                    if(card == suggestedCards[cardType]){
                        var refute_list = document.getElementById("refute-options");
                        var option = document.createElement("option");
                        option.text = idToText[card]['name'];
                        refute_list.add(option);
                    };
                });
            });
            $("#turn-options-menu").hide();
            $("#refute-suggestion-menu").show();
        }

        function makeAccusation() {
            var weapon = $("#accuse-weapon option:selected").text();
            var room = $("#accuse-location option:selected").text();
            var suspect = $("#accuse-suspect option:selected").text();

            if (idToText[solution_cards["Weapons"][0]]["name"] == weapon &&
              idToText[solution_cards["Rooms"][0]]["name"] == room &&
              idToText[solution_cards["Suspects"][0]]["name"] == suspect) {
                showSolutionSet({{player_name | safe}});
            } else {
                showLoserSet();
            };

        }

        function makeSuggestion() {
            player_hand = {{player_hand|safe}};
            solution_cards = {{solution_cards|safe}};

            var weapon = textToId[$("#suggest-weapon  option:selected").text()];
            var suspect = textToId[$("#suggest-suspect option:selected").text()];
            var room = {{player_location | safe }};

            if(idToText[solution_cards["Weapons"][0]]["name"] == weapon &&
               idToText[solution_cards["Rooms"][0]]["name"] == room &&
               idToText[solution_cards["Suspects"][0]]["name"] == suspect){
                alert('You Won!!!');
                url = "/play/?player_status=won";

                $.ajax({
                   type: "POST",
                    url: url,
                    success: function() {
                        location.reload();
                    }
                });
            }
            else if(player_hand["Weapons"].includes(weapon) &&
                    player_hand["Rooms"].includes(room) &&
                    player_hand["Suspects"].includes(suspect)){
                alert('You cannot suggest only your cards...');
            }
            else if((player_hand["Weapons"].includes(weapon) || solution_cards["Weapons"].includes(weapon)) &&
                    (player_hand["Rooms"].includes(room) || solution_cards["Rooms"].includes(room)) &&
                    (player_hand["Suspects"].includes(suspect) || solution_cards["Suspects"].includes(suspect))){

                if(solution_cards["Weapons"].includes(weapon)){
                    var refute_card = weapon;
                }
                else if(solution_cards["Rooms"].includes(room)){
                    var refute_card = room;
                }
                else if(solution_cards["Suspects"].includes(suspect)){
                    var refute_card = suspect;
                }
                //var url = "/play/?refute_card=" + refute_card;

                url = "/play/?suggest_room=" + room +
                "&suggest_weapon=" + weapon +
                "&suggest_suspect="+ suspect +
                "&suggest_suspect_name="+ $("#suggest-suspect option:selected").text() +
                "&refute_card=" + refute_card;

                $.ajax({
                    type: "POST",
                    url: url,
                    success: function(){
                    location.reload();
                }
            });
            }
            else{
                url = "/play/?suggest_room=" + room +
                "&suggest_weapon=" + weapon +
                "&suggest_suspect="+ suspect +
                "&suggest_suspect_name="+ $("#suggest-suspect option:selected").text();

                $.ajax({
                    type: "POST",
                    url: url,
                    success: function() {
                    location.reload();
                    }
                });
            }
        };

        function refuteSuggestion() {

            var refute_card = textToId[$("#refute-options option:selected").text()];

            var url = "/play/?refute_card=" + refute_card;
            $.ajax({
                type: "POST",
                url: url,
                success: function(){
                    location.reload();
                }
            });
        };

        function end_turn(){
            var url = "/play/?end_turn=true";
            $.ajax({
                type: "POST",
                url: url,
                success: function(){
                    location.reload();
                }
            });
        };

        function getSolutionMessage() {
            let solution = "<p>It was " + idToText[solution_cards["Suspects"][0]]["name"] + " in the " + idToText[solution_cards["Rooms"][0]]["name"] + " with the " + idToText[solution_cards["Weapons"][0]]["name"] + ".</p>";
            solution +=
                "<div class='row'>" + 
                    "<div class='col-xs-4'>" +
                        "<img class='card' src='" + idToText[solution_cards["Suspects"][0]].cardPic + "'/>" +
                    "</div>" +
                    "<div class='col-xs-4'>" +
                        "<img class='card' src='" + idToText[solution_cards["Rooms"][0]].cardPic + "'/>" +
                    "</div>" +
                    "<div class='col-xs-4'>" +
                        "<img class='card' src='" + idToText[solution_cards["Weapons"][0]].cardPic + "'/>" +
                    "</div>" +
                "</div>";
            return solution;
        }

        //show solution set at end of the game
        function showSolutionSet(gameWinner) {
        	var solutionString = "<p>" + gameWinner + " has won the game!</p>" + getSolutionMessage();

        	document.getElementById("modalBody").innerHTML = solutionString;
        	$("#endgameButton").show();
        	$("#closeModal").hide();
        	$("#solutionContainer").show();
        	$("#solutionModal").modal();
    	}

    	//show solution to loser
    	function showLoserSet() {
        	var solutionString = "<p>You have lost the game!</p>" + getSolutionMessage();

        	document.getElementById("modalBody").innerHTML = solutionString;
        	$("#endgameButton").hide();
        	$("#closeModal").show();
        	$("#solutionContainer").show();
        	$("#solutionModal").modal();
    	}

    	//end game method
    	function endGame() {

    		url = "/play/?player_status=won";

    		$.ajax({
                type: "POST",
                url: url,
                success: function() {
                    location.reload();
                }
            });
            location.replace("/");
    	}

    	//end game method
    	function loserUpdate() {

    		url = "/play/?player_status=lost";

    		$.ajax({
                type: "POST",
                url: url,
                success: function() {
                    location.reload();
                }
            });
    	}

    </script>

    <head>
        <style>
            #board-container {
                position: relative;
            }
            .board {
                float: left;
                overflow: hidden;
            }
            .board img {
                max-height: 150px;
            }
            .horizontal {
                width: 50px;
                margin-top: 50px;
            }
            .vertical {
                height: 50px;
                margin-left: 50px;
            }
            .col-2 {
                margin-left: 150px;
            }
            .col-3 {
                margin-left: 150px;
            }
            .token {
                position: absolute;
                border-radius: 0.5em;
                z-index: 1;
            }
            .weapon {
                border: 2px solid black;
                margin-top: 110px;
                margin-left: 10px;
                width: 25px;
            }
            .player {
                border: 2px solid white;
                margin-left: 5px;
                margin-top: 10px;
                width: 30px;
            }
            .column {
                float: left;
                width: 10%;
                padding: 1px;
                margin-left: 10px;
            }
            .cards {
                display: flex;
                align-content: center;
                max-width: 40em;
            }
            .cardWrapper {
                overflow: hidden;
            }
            .cardWrapper:last-child, .cardWrapper:hover {
                overflow: visible;
            }
            .card {
                width: 10em;
                min-width: 10em;
                height: 16em;
                border-radius: 0.5em;
                border: solid #AAA 1px;
                padding: 0.25em;

                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
        </style>
    </head>
    <body>
        <div class="jumbotron">
            <div class="container" id="game-info">
                {% if player_turn|lower == 'true' %}
                <h2>Your Turn</h2>
                {% else %}
                <h2>{{curr_player_turn | safe}} Turn</h2>
                {% endif %}
            </div>
        </div>
        <div class="container">
            <div class="col-xs-12 col-sm-8">
                <h3 id="player-location-msg"></h3>

                <div id="board-container">
                    <div class="col-xs-12">
                        <div class="board room" id="r9">
                            <div class="row" id="r9c"></div>
                            <div class="row" id="r9w"></div>
                        </div>
                        <div class="board horizontal" id="h1"></div>
                        <div class="board room" id="r5">
                            <div class="row" id="r5c"></div>
                            <div class="row" id="r5w"></div>
                        </div>
                        <div class="board horizontal" id="h2"></div>
                        <div class="board room" id="r8">
                            <div class="row" id="r8c"></div>
                            <div class="row" id="r8w"></div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <div class="board vertical" id="h3"></div>
                        <div class="board vertical col-2" id="h4"></div>
                        <div class="board vertical col-3" id="h5"></div>
                    </div>
                    <div class="col-xs-12">
                        <div class="board room" id="r7">
                            <div class="board room row" id="r7c"></div>
                            <div class="board room row" id="r7w"></div>
                        </div>
                        <div class="board horizontal" id="h6"></div>
                        <div class="board room" id="r2">
                            <div class="row" id="r2c"></div>
                            <div class="row" id="r2w"></div>
                        </div>
                        <div class="board horizontal" id="h7"></div>
                        <div class="board room" id="r4">
                            <div class="row" id="r4c"></div>
                            <div class="row" id="r4w"></div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <div class="board vertical" id="h8"></div>
                        <div class="board vertical col-2" id="h9"></div>
                        <div class="board vertical col-3" id="h10"></div>
                    </div>
                    <div class="col-xs-12">
                        <div class="board room" id="r3">
                            <div class="row" id="r3c"></div>
                            <div class="row" id="r3w"></div>
                        </div>
                        <div class="board horizontal" id="h11"></div>
                        <div class="board room" id="r1">
                            <div class="row" id="r1c"></div>
                            <div class="row" id="r1w"></div>
                        </div>
                        <div class="board horizontal" id="h12"></div>
                        <div class="board room" id="r6">
                            <div class="row" id="r6c"></div>
                            <div class="row" id="r6w"></div>
                        </div>
                    </div>
                </div>

                <!-- Turn handling -->
                <row class="is-players-turn" id="turn-options-menu">

                    <h3>Turn Options</h3>
                    <div id="turn-options">

                        {% if player_moved|lower == 'false' and player_suggested|lower == 'false' and player_turn|lower == 'true' and 'Weapons' not in suggested_cards|safe %}
                            <button class="btn btn-primary" onclick="move()">Move</button>
                        {% endif %}

                        {% if player_suggested|lower == 'false' and 'room' in player_location and player_turn|lower == 'true' %}
                            {% if player_moved|lower == 'true' or player_moved_suggest|lower == 'true' %}
                                <button class="btn btn-primary" onclick="suggest()">Make a Suggestion</button>
                            {% endif %}
                        {% endif %}

                        {% if 'Weapons' not in suggested_cards|safe and player_turn|lower == 'true' %}
                        <button class="btn btn-primary" onclick="accuse()">Make an Accusation</button>
                        {% endif %}

                        <br><br>

                        {% if 'Weapons' in suggested_cards|safe and player_turn|lower == 'false'%}
                            <button class="btn btn-primary" onclick="refute()">Refute Suggestion</button>
                        {% endif %}

                        {% if 'Weapons' not in suggested_cards|safe and player_turn|lower == 'true' %}
                        <button class="btn btn-primary" onclick="end_turn()">End Turn</button>
                        {% endif %}
                    </div>
                </row>

                <row class="is-players-turn" id="move-options-menu">
                    <h3>Move Options</h3>
                    <button class="btn btn-primary" onclick="showTurnOptions()">Back to Turn Options</button>
                    <br><br>
                    <div class="form-group">
                        <label for="sel1">Pick a location:</label>
                        <select class="form-control" id="move-options"></select>
                    </div>
                    <button class="btn btn-primary" onclick="movePlayer()">Move</button>
                </row>

                <row class="is-players-turn" id="make-suggestion-menu">
                    <h3>Make a Suggestion</h3>
                    <button class="btn btn-primary" onclick="showTurnOptions()">Back to Turn Options</button>
                    <div class="form-group">
                        <label for="suggest-weapon">Choose one Weapon:</label>
                        <select class="form-control" id="suggest-weapon"></select>
                    </div>
                    <div class="form-group">
                        <label for="suggest-suspect">Choose one Suspect:</label>
                        <select class="form-control" id="suggest-suspect"></select>
                    </div>
                    <button class="btn btn-primary" onclick="makeSuggestion()">Suggest</button>
                </row>

                <row class="is-players-turn" id="make-accusation-menu">
                    <h3>Make an Accusation</h3>
                    <button class="btn btn-primary" onclick="showTurnOptions()">Back to Turn Options</button>
                    <div class="form-group">
                        <label for="accuse-weapon">Choose one Weapon:</label>
                        <select class="form-control" id="accuse-weapon"></select>
                    </div>
                    <div class="form-group">
                        <label for="accuse-suspect">Choose one Suspect:</label>
                        <select class="form-control" id="accuse-suspect"></select>
                    </div>
                    <div class="form-group">
                        <label for="accuse-location">Choose one Room:</label>
                        <select class="form-control" id="accuse-location"></select>
                    </div>
                    <button class="btn btn-primary" onclick="makeAccusation()">Accuse</button>
                    <p><em>NOTE: if you make an incorrect Accusation, you automatically lose the game.</em></p>
                </row>

                <row class="is-players-turn" id="refute-suggestion-menu">
                    <h3>Refute a Suggestion</h3>
                    <button onclick="showTurnOptions()">Back to Turn Options</button>
                    <div class="form-group">
                        <label for="accuse-suspect">Choose a card from your hand:</label>
                        <select class="form-control" id="refute-options"></select>
                    </div>
                    <button class="btn btn-primary" onclick="refuteSuggestion()">Refute</button>
                </row>

                <!-- Player hand -->
                <h3>Your Hand</h3>
                <div id="player-hand" class="cards">
                </div>
            </div>
            <div class="col-xs-12 col-sm-4" id="notebook-container">
                <h3>Detective Notebook</h3>
                <table class="table" id="notebook">
                    <thead>
                        <th>Evidence Type</th>
                        <th>Evidence</th>
                        <th>Seen?</th>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- modal div -->
        <div class="container" id="solutionContainer">
            <div class="modal fade" id="solutionModal" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                	    <div class="modal-header">
                	    	<h4 class="modal-title">Game Over!</h4>
                	    </div>
                	    <div class="modal-body" id="modalBody">
                            <div class="row">
                                <div class="col-xs-4">
                                    <img class="card" alt="solution suspect picture" id="solution-suspect-card" />
                                </div>
                                <div class="col-xs-4">
                                    <img class="card" alt="solution room picture" id="solution-room-card" />
                                </div>
                                <div class='col-xs-4'>
                                    <img class="card" alt="solution weapon picture" id="solution-weapon-card" />
                                </div>
                            </div>
                        </div>
                	    <div class="modal-footer">
                      		<button type="button" onclick="endGame()" id="endgameButton" class="btn btn-default">End game</button>
                      		<button type="button" onclick="loserUpdate()" id="closeModal" class="btn btn-default" data-dismiss="modal">Close</button>
                      	</div>
                	</div>
               	</div>
           	</div>
       	</div>

    </body>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

{% endblock %}
