{% load static from staticfiles %}
{% block content %}

    <body>
        <div class="jumbotron">
            <div class="container">
                <h2>Entry Way</h2>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <h3>Hello {{player_name | safe }}</h3>
                <p>The victim: John Boddy, 37, millionaire inventor of sliced bread</p>
                <p>The crime: Boddy was hosting a dinner party for you and several other guests, and after some hubbub you found his corpse here in the entryway. It seems to have been dragged here... but from where? How did he die? And most importantly, who killed him?</p>
                <p>The mystery: Several people in this room stand to gain from his death, but who would have stooped so low as to murder their host in his own home?</p>
                <p>The suspects:</p>
                <div class="media">
                    <div class="media-left">
                        <img src="{% static 'images/avatar_col_mustard.png' %}" class="media-object" style="width:90px">
                    </div>
                    <div class="media-body">
                        {% if 'Colonel Mustard' in all_names|safe %}
                        <h4 class="media-heading">Colonel Mustard (Used)</h4>
                        {% else %}
                        <h4 class="media-heading">Colonel Mustard </h4>
                        {% endif %}
                        <p>Colonel Michael Mustard is a gallant military hero whose glittering career hides a tarnished past. He enjoys an adventure and must always succeed in battle, no matter what, even if it means betraying his allies to defeat the enemy.</p>
                        {% if 'Colonel Mustard' not in all_names|safe %}
                        <button class="btn" onclick="setPlayerToken('Colonel Mustard')">Play as Colonel Mustard</button>
                        {% endif %}
                    </div>
                </div>
                <div class="media">
                    <div class="media-left">
                        <img src="{% static 'images/avatar_mrs_white.png' %}" class="media-object" style="width:90px">
                    </div>
                    <div class="media-body">
                        {% if 'Mrs. White' in all_names|safe %}
                        <h4 class="media-heading">Mrs. White (Used)</h4>
                        {% else %}
                        <h4 class="media-heading">Mrs. White </h4>
                        {% endif %}
                        <p>Blanche White is the loyal housekeeper and devoted confidant of the deceased, but she hides a past littered with extortion and deadly arson. </p>
                        {% if 'Mrs. White' not in all_names|safe %}
                        <button class="btn" onclick="setPlayerToken('Mrs. White')">Play as Mrs. White</button>
                        {% endif %}
                    </div>
                </div>
                <div class="media">
                    <div class="media-left">
                        <img src="{% static 'images/avatar_prof_plum.png' %}" class="media-object" style="width:90px">
                    </div>
                    <div class="media-body">
                        {% if 'Professor Plum' in all_names|safe %}
                        <h4 class="media-heading">Professor Plum (Used)</h4>
                        {% else %}
                        <h4 class="media-heading">Professor Plum </h4>
                        {% endif %}
                        <p>Professor Peter Plum is a man with a degree of suspicion. Would his research methods stand the scrutiny of a microscope?</p>
                        {% if 'Professor Plum' not in all_names|safe %}
                        <button class="btn" onclick="setPlayerToken('Professor Plum')">Play as Professor Plum</button>
                        {% endif %}
                    </div>
                </div>
                <div class="media">
                    <div class="media-left">
                        <img src="{% static 'images/avatar_mrs_peacock.png' %}" class="media-object" style="width:90px">
                    </div>
                    <div class="media-body">
                        {% if 'Mrs. Peacock' in all_names|safe %}
                        <h4 class="media-heading">Mrs. Peacock (Used)</h4>
                        {% else %}
                        <h4 class="media-heading">Mrs. Peacock </h4>
                        {% endif %}
                        <p>Elizabeth Peacock is a beautiful society hostess with a reputation that she would rather forget. She is nicknamed "Ma Bluebird" because of the mysterious deaths of her husbands.</p>
                        {% if 'Mrs. Peacock' not in all_names|safe %}
                        <button class="btn" onclick="setPlayerToken('Mrs. Peacock')">Play as Mrs. Peacock</button>
                        {% endif %}
                    </div>
                </div>
                <div class="media">
                    <div class="media-left">
                        <img src="{% static 'images/avatar_mr_green.png' %}" class="media-object" style="width:90px">
                    </div>
                    <div class="media-body">
                        {% if 'Mr. Green' in all_names|safe %}
                        <h4 class="media-heading">Mr. Green (Used)</h4>
                        {% else %}
                        <h4 class="media-heading">Mr. Green </h4>
                        {% endif %}
                        <p>Jonathan Green is questioned by many on whether he is a saint or sinner. Known for shady dealings on the stock market, he used this money to "help" the Church of England.</p>
                        {% if 'Mr. Green' not in all_names|safe %}
                        <button class="btn" onclick="setPlayerToken('Mr. Green')">Play as Mr. Green</button>
                        {% endif %}
                    </div>
                </div>
                <div class="media">
                    <div class="media-left">
                        <img src="{% static 'images/avatar_ms_scarlett.png' %}" class="media-object" style="width:90px">
                    </div>
                    <div class="media-body">
                        {% if 'Miss Scarlet' in all_names|safe %}
                        <h4 class="media-heading">Miss Scarlet (Used)</h4>
                        {% else %}
                        <h4 class="media-heading">Miss Scarlet </h4>
                        {% endif %}
                        <p>Vivienne Scarlet is a vivacious aspiring actress whose passion for fame, fortune, and especially men will let no one stand in her way. She is the daughter of Mrs. Peacock and the former fianc√©e of Mr. John Boddy.</p>
                        {% if 'Miss Scarlet' not in all_names|safe %}
                        <button class="btn" onclick="setPlayerToken('Miss Scarlet')">Play as Miss Scarlet</button>
                        {% endif %}
                    </div>
                </div>
                
            </div>
            <div class="row">
                <h3>Waiting for other players to join the game...</h3>
                <p>Only the game creator can start the game, if there are 2-6 people waiting</p>
                <form action="/play">
                    <input class="btn btn-primary" id="start-button" type="submit" value="Start Game" />
                </form>
                <button class="btn btn-primary" onclick="leaveGame()">Leave Game</button>
            </div>
        </div>
        

    </body>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        console.log("Current data, per user:");
        console.log("Message:", {{ msg | safe }});
        console.log("Game ID:", {{ game_id | safe }});
        console.log("Is Player Game Creator:", {{ is_creator | safe }});
        console.log("All Players:", {{ all_names | safe }});
        console.log("Game Status:", {{ game_status | safe }});

        $(document).ready(function() {
            const players = {{ all_names | safe }};
            if (players.length < 3 || players.length > 6) {
                $("#start-button").addClass("disabled");
                $("#start-button").attr("title", "You must have 3-6 players to start the game");
            }
        });
        //if("{{ game_status | safe }}" == "IN_PROGRESS"){
        //    location.replace("/play/");
        //};

        if(location.href.includes("game=")){
            location.replace("/customize/");
        }

        // Listen for game updates
            setInterval(function(){
                if(location.href.includes("game=")){
                    location.replace("/customize/");
                }
                else{
                    location.reload();
                }
            }, 5000);

        function setPlayerToken(name){
            url = "/customize/?token=" + name;
            $.ajax({
                type: "POST",
                url: url,
                success: function() {                    
                    if(location.href.includes("game=")){
                        location.replace("/customize/");
                    }
                    else{
                        location.reload();
                    }
                }
            });
        }

        function leaveGame(){
            url = "/customize/?leave_game=" + "True";
            $.ajax({
                type: "POST",
                url: url,
                success: function() {
                    location.replace("/");
                }
            });
        }
    </script>

{% endblock %}